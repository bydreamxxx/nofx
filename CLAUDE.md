# CLAUDE.md

æœ¬æ–‡ä»¶ä¸º Claude Code (claude.ai/code) åœ¨æ­¤ä»£ç ä»“åº“ä¸­å·¥ä½œæ—¶æä¾›æŒ‡å¯¼ã€‚

## é¡¹ç›®æ¦‚è¿°

NOFX æ˜¯ä¸€ä¸ª AI é©±åŠ¨çš„åŠ å¯†è´§å¸æœŸè´§è‡ªåŠ¨äº¤æ˜“ç«èµ›ç³»ç»Ÿï¼Œæ”¯æŒå¤šä¸ªäº¤æ˜“æ‰€ï¼ˆBinanceã€Hyperliquidã€Aster DEXï¼‰å’Œå¤šä¸ª AI æ¨¡å‹ï¼ˆDeepSeekã€Qwen æˆ–è‡ªå®šä¹‰ OpenAI å…¼å®¹ APIï¼‰ã€‚è¯¥ç³»ç»Ÿå…·æœ‰é€šè¿‡å†å²æ€§èƒ½åé¦ˆè¿›è¡Œ AI è‡ªæˆ‘å­¦ä¹ ã€å¤šäº¤æ˜“å‘˜ç«èµ›æ¨¡å¼ä»¥åŠä¸“ä¸šçš„ React ç›‘æ§ä»ªè¡¨æ¿ç­‰ç‰¹æ€§ã€‚

## å¼€å‘å‘½ä»¤

### åç«¯ (Go)

```bash
# æ„å»ºåç«¯
go build -o nofx

# è¿è¡Œåç«¯ï¼ˆä»é¡¹ç›®æ ¹ç›®å½•ï¼‰
./nofx

# ä½¿ç”¨è‡ªå®šä¹‰é…ç½®è¿è¡Œ
./nofx path/to/config.json

# å®‰è£…ä¾èµ–
go mod download

# è¿è¡Œæµ‹è¯•
go test ./...
```

### å‰ç«¯ (React + TypeScript)

```bash
# å®‰è£…ä¾èµ–
cd web
npm install

# å¼€å‘æœåŠ¡å™¨ï¼ˆè¿è¡Œåœ¨ 3000 ç«¯å£ï¼‰
npm run dev

# ç”Ÿäº§æ„å»º
npm run build

# é¢„è§ˆç”Ÿäº§æ„å»º
npm run preview
```

### Docker éƒ¨ç½²

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼ˆåç«¯ + å‰ç«¯ï¼‰
docker compose up -d --build

# æŸ¥çœ‹æ—¥å¿—
docker compose logs -f

# åœæ­¢æœåŠ¡
docker compose down

# é‡å¯æœåŠ¡
docker compose restart
```

## é«˜å±‚æ¶æ„

### ç³»ç»Ÿç»„ä»¶

ç³»ç»Ÿç”±ä¸‰ä¸ªä¸»è¦å±‚æ¬¡ç»„æˆï¼š

1. **åç«¯ (Go)** - äº¤æ˜“é€»è¾‘ã€AI é›†æˆã€å¸‚åœºåˆ†æå’Œ REST API
2. **å‰ç«¯ (React + TypeScript)** - å®æ—¶ç›‘æ§ä»ªè¡¨æ¿ï¼ŒåŒ…å«å›¾è¡¨å’Œç«èµ›æ’è¡Œæ¦œ
3. **å¤–éƒ¨æœåŠ¡** - äº¤æ˜“æ‰€ APIï¼ˆBinance/Hyperliquid/Asterï¼‰ã€AI APIï¼ˆDeepSeek/Qwen/è‡ªå®šä¹‰ï¼‰ã€å¯é€‰çš„å¸ç§æ±  API

### æ ¸å¿ƒæ¶æ„æ¨¡å¼ï¼šå¤šäº¤æ˜“å‘˜ç«èµ›

ç³»ç»Ÿä½¿ç”¨**ç®¡ç†è€…-å·¥ä½œè€…æ¨¡å¼**ï¼š
- `TraderManager` (manager/trader_manager.go) åè°ƒå¤šä¸ª `AutoTrader` å®ä¾‹
- æ¯ä¸ª `AutoTrader` (trader/auto_trader.go) æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å·¥ä½œè€…ï¼Œæ‹¥æœ‰è‡ªå·±çš„ï¼š
  - äº¤æ˜“æ‰€è¿æ¥å™¨ï¼ˆé€šè¿‡ `Trader` æ¥å£ï¼‰
  - AI å®¢æˆ·ç«¯ï¼ˆé€šè¿‡ `mcp.Client`ï¼‰
  - å†³ç­–æ—¥å¿—è®°å½•å™¨ï¼ˆé€šè¿‡ `logger.DecisionLogger`ï¼‰
  - ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆå¯åŠ¨/åœæ­¢/æš‚åœï¼‰

è¿™å…è®¸å¤šä¸ª AI æ¨¡å‹åŒæ—¶è¿›è¡Œäº¤æ˜“ç«èµ›ï¼ˆä¾‹å¦‚ Qwen vs DeepSeekï¼‰ã€‚

### æ•°æ®æµï¼šå†³ç­–å¾ªç¯

æ ¸å¿ƒäº¤æ˜“å¾ªç¯æ¯ 3-5 åˆ†é’Ÿæ‰§è¡Œä»¥ä¸‹åºåˆ—ï¼š

```
AutoTrader.Start() â†’ [æ¯éš” scan_interval_minutes]
  â†“
1. è·å–è´¦æˆ·ä½™é¢å’ŒæŒä»“ï¼ˆTrader æ¥å£ï¼‰
  â†“
2. è·å–å†å²æ€§èƒ½ï¼ˆDecisionLogger.GetPerformanceAnalysisï¼‰
  â†“
3. æ„å»ºäº¤æ˜“ä¸Šä¸‹æ–‡ï¼ˆdecision.Contextï¼‰ï¼š
   - è´¦æˆ·ä¿¡æ¯ï¼ˆæƒç›Šã€ä¿è¯é‡‘ä½¿ç”¨ç‡ã€ç›ˆäºï¼‰
   - æŒä»“ä¿¡æ¯åŠå®æ—¶å¸‚åœºæ•°æ®
   - å€™é€‰å¸ç§æ± ï¼ˆAI500 + OI Top æˆ–é»˜è®¤å¸ç§ï¼‰
   - å†å²æ€§èƒ½åé¦ˆï¼ˆèƒœç‡ã€æœ€ä½³/æœ€å·®å¸ç§ï¼‰
  â†“
4. ç”Ÿæˆ AI å†³ç­–ï¼ˆdecision.GetFullDecisionï¼‰ï¼š
   - æ„å»ºç³»ç»Ÿæç¤ºï¼ˆè§„åˆ™ã€é£é™©é™åˆ¶ã€æ æ†é…ç½®ï¼‰
   - æ„å»ºç”¨æˆ·æç¤ºï¼ˆå¸‚åœºæ•°æ®ã€æŒ‡æ ‡ã€æŒä»“ï¼‰
   - ä½¿ç”¨æ€ç»´é“¾æ¨ç†è°ƒç”¨ AI API
   - è§£æ JSON å†³ç­–ï¼ˆå¼€å¤š/å¹³å¤š/å¼€ç©º/å¹³ç©º/æŒæœ‰/ç­‰å¾…ï¼‰
  â†“
5. æ‰§è¡Œå†³ç­–ï¼ˆAutoTrader.executeDecisionsï¼‰ï¼š
   - ä¼˜å…ˆçº§ï¼šå…ˆå¹³ä»“ç°æœ‰æŒä»“ï¼Œå†å¼€æ–°ä»“
   - é£é™©æ£€æŸ¥ï¼ˆæŒä»“é™åˆ¶ã€ä¿è¯é‡‘ä½¿ç”¨ç‡ã€é‡å¤æŒä»“ï¼‰
   - é€šè¿‡äº¤æ˜“æ‰€ API æ‰§è¡Œï¼ˆBinance/Hyperliquid/Asterï¼‰
   - è®¾ç½®æ­¢æŸå’Œæ­¢ç›ˆè®¢å•
  â†“
6. è®°å½•å†³ç­–å¹¶æ›´æ–°æ€§èƒ½ï¼ˆDecisionLogger.LogDecisionï¼‰ï¼š
   - ä¿å­˜å®Œæ•´å†³ç­–è®°å½•ï¼ˆCoTã€æç¤ºè¯ã€æ‰§è¡Œç»“æœï¼‰
   - é€šè¿‡ symbol_side åŒ¹é…å¼€å¹³ä»“å¯¹ï¼ˆä¾‹å¦‚ "BTCUSDT_long"ï¼‰
   - è®¡ç®—å‡†ç¡®çš„ USDT ç›ˆäº = æŒä»“ä»·å€¼ Ã— ä»·æ ¼å˜åŒ–% Ã— æ æ†
   - æ›´æ–°èƒœç‡ã€ç›ˆäºæ¯”ã€å¤æ™®æ¯”ç‡
  â†“
7. é€šè¿‡ REST API æä¾›æ•°æ®ï¼ˆapi/server.goï¼‰
  â†“
8. åœ¨ Web ä»ªè¡¨æ¿æ˜¾ç¤ºï¼ˆReact ç»„ä»¶ï¼‰
```

### äº¤æ˜“æ‰€æŠ½è±¡å±‚

`Trader` æ¥å£ï¼ˆtrader/interface.goï¼‰ä¸ºæ‰€æœ‰äº¤æ˜“æ‰€æä¾›ç»Ÿä¸€çš„ APIï¼š
- **Binance**ï¼š`FuturesTrader`ï¼ˆtrader/binance_futures.goï¼‰- ä½¿ç”¨ go-binance SDK
- **Hyperliquid**ï¼š`HyperliquidTrader`ï¼ˆtrader/hyperliquid_trader.goï¼‰- ä½¿ç”¨ go-hyperliquid SDKï¼Œéœ€è¦ä»¥å¤ªåŠç§é’¥
- **Aster**ï¼š`AsterTrader`ï¼ˆtrader/aster_trader.goï¼‰- Binance å…¼å®¹ APIï¼Œä½¿ç”¨ Web3 é’±åŒ…è®¤è¯

æ‰€æœ‰äº¤æ˜“æ‰€å®ç°å¿…é¡»å¤„ç†ï¼š
- æŒä»“ç®¡ç†ï¼ˆå¼€å¤š/å¹³å¤š/å¼€ç©º/å¹³ç©ºï¼‰
- æ æ†é…ç½®
- è®¢å•ç²¾åº¦ï¼ˆä»äº¤æ˜“æ‰€ä¿¡æ¯è·å– LOT_SIZEï¼‰
- æ­¢æŸå’Œæ­¢ç›ˆè®¢å•

### AI é›†æˆæ¶æ„

`mcp.Client`ï¼ˆmcp/client.goï¼‰æ”¯æŒä¸‰ç§ AI æä¾›å•†ç±»å‹ï¼š
- **DeepSeek**ï¼š`https://api.deepseek.com/v1` ä½¿ç”¨æ¨¡å‹ `deepseek-chat`
- **Qwen**ï¼š`https://dashscope.aliyuncs.com/compatible-mode/v1` ä½¿ç”¨æ¨¡å‹å¦‚ `qwen-plus`
- **è‡ªå®šä¹‰**ï¼šä»»ä½• OpenAI å…¼å®¹ APIï¼ˆæ”¯æŒå¸¦ `#` åç¼€çš„å®Œæ•´ URL ä»¥è·³è¿‡è‡ªåŠ¨è·¯å¾„ï¼‰

æ‰€æœ‰æä¾›å•†ä½¿ç”¨ç›¸åŒçš„æ¥å£ï¼š
```go
CallWithMessages(systemPrompt, userPrompt string) (string, error)
```

AI æ¥æ”¶ï¼š
- **ç³»ç»Ÿæç¤º**ï¼šäº¤æ˜“è§„åˆ™ã€é£é™©é™åˆ¶ã€æ æ†é…ç½®ã€JSON è¾“å‡ºæ¨¡å¼
- **ç”¨æˆ·æç¤º**ï¼šå®æ—¶å¸‚åœºæ•°æ®ã€æŠ€æœ¯æŒ‡æ ‡ã€å†å²æ€§èƒ½ã€æŒä»“ä¿¡æ¯

AI è¿”å›å¸¦æœ‰æ€ç»´é“¾æ¨ç†çš„ç»“æ„åŒ– JSONã€‚

### è‡ªæˆ‘å­¦ä¹ åé¦ˆå¾ªç¯

å…³é”®ç‰¹æ€§ï¼šç³»ç»Ÿä»è¿‡å»çš„äº¤æ˜“ä¸­å­¦ä¹ ã€‚

**æ€§èƒ½è·Ÿè¸ª**ï¼ˆlogger/decision_logger.goï¼‰ï¼š
- å­˜å‚¨æŒä»“è®°å½•åŒ…å«ï¼š`symbol_side`ã€`quantity`ã€`leverage`ã€`entry_price`ã€`timestamp`
- é€šè¿‡ `symbol_side` é”®åŒ¹é…å¹³ä»“æ“ä½œä¸å¼€ä»“æŒä»“ï¼ˆé˜²æ­¢å¤šç©ºå†²çªï¼‰
- è®¡ç®—å‡†ç¡®çš„ USDT ç›ˆäºï¼š`æŒä»“ä»·å€¼ Ã— ä»·æ ¼å˜åŒ–% Ã— æ æ†`
- æ±‡æ€»ç»Ÿè®¡æ•°æ®ï¼šèƒœç‡ã€ç›ˆäºæ¯”ï¼ˆå¹³å‡ç›ˆåˆ©/å¹³å‡äºæŸï¼‰ã€å¤æ™®æ¯”ç‡

**åé¦ˆç»™ AI**ï¼ˆdecision/engine.goï¼‰ï¼š
- æ¯æ¬¡å†³ç­–å‰ï¼ŒåŠ è½½æœ€è¿‘ 20 æ¡äº¤æ˜“è®°å½•
- ç”Ÿæˆ `PerformanceAnalysis` åŒ…å«ï¼š
  - æ•´ä½“ç»Ÿè®¡ï¼ˆæ€»äº¤æ˜“æ•°ã€èƒœç‡ã€å¹³å‡ç›ˆäºï¼‰
  - æ¯ä¸ªå¸ç§çš„æ€§èƒ½ï¼ˆæœ€ä½³/æœ€å·®è¡¨ç°è€…ï¼‰
  - æœ€è¿‘çš„äº¤æ˜“ï¼ˆæœ€è¿‘ 5 æ¡ï¼ŒåŒ…å«å…¥åœº â†’ å‡ºåœº â†’ ç›ˆäºï¼‰
- å°†æ­¤åé¦ˆæ³¨å…¥ç”¨æˆ·æç¤º

**AI é€‚åº”**ï¼š
- é¿å…é‡å¤é”™è¯¯ï¼ˆä¾‹å¦‚ï¼Œè¿ç»­äºæŸçš„å¸ç§ï¼‰
- å¼ºåŒ–æˆåŠŸæ¨¡å¼ï¼ˆä¾‹å¦‚ï¼Œé«˜èƒœç‡ç­–ç•¥ï¼‰
- æ ¹æ®å¸‚åœºæ¡ä»¶è°ƒæ•´äº¤æ˜“é£æ ¼

### é…ç½®ç³»ç»Ÿ

`config.json` æ–‡ä»¶æ§åˆ¶æ‰€æœ‰ç³»ç»Ÿè¡Œä¸ºï¼ˆconfig/config.goï¼‰ï¼š

**å…³é”®é…ç½®æ¦‚å¿µ**ï¼š
- **å¤šäº¤æ˜“å‘˜è®¾ç½®**ï¼šäº¤æ˜“å‘˜é…ç½®æ•°ç»„ï¼Œæ¯ä¸ªéƒ½æœ‰å”¯ä¸€ IDã€åç§°ã€AI æ¨¡å‹ã€äº¤æ˜“æ‰€å‡­è¯
- **äº¤æ˜“å‘˜å¯ç”¨/ç¦ç”¨**ï¼š`enabled: true/false` å…è®¸é€‰æ‹©æ€§æ¿€æ´»äº¤æ˜“å‘˜
- **æ æ†é…ç½®**ï¼š`BTCETHLeverage` å’Œ `AltcoinLeverage` è®¾ç½®æœ€å¤§æ æ†ï¼ˆâš ï¸ Binance å­è´¦æˆ· â‰¤5xï¼‰
- **å¸ç§æ± æ¨¡å¼**ï¼š
  - é»˜è®¤æ¨¡å¼ï¼š`use_default_coins: true` ä½¿ç”¨ç¡¬ç¼–ç åˆ—è¡¨ï¼ˆBTCã€ETHã€SOL ç­‰ï¼‰
  - é«˜çº§æ¨¡å¼ï¼š`use_default_coins: false` + AI500 å’Œ OI Top çš„å¤–éƒ¨ API
- **AI æä¾›å•†**ï¼š`ai_model` å¯ä»¥æ˜¯ "deepseek"ã€"qwen" æˆ– "custom"ï¼Œå¯¹åº”ç›¸åº”çš„ API å¯†é’¥

**è‡ªåŠ¨é»˜è®¤å€¼**ï¼š
- å¦‚æœ `use_default_coins` ä¸º false ä½†æœªæä¾› `coin_pool_api_url` â†’ è‡ªåŠ¨å¯ç”¨é»˜è®¤å¸ç§
- å¦‚æœæœªæŒ‡å®š `exchange` â†’ é»˜è®¤ä¸º "binance"
- å¦‚æœæœªæŒ‡å®šæ æ† â†’ é»˜è®¤ä¸º 5xï¼ˆå¯¹ Binance å­è´¦æˆ·å®‰å…¨ï¼‰

### å¸‚åœºæ•°æ®å’ŒæŠ€æœ¯æŒ‡æ ‡

`market` åŒ…ï¼ˆmarket/data.goï¼‰è·å–å¹¶è®¡ç®—ï¼š
- **3 åˆ†é’Ÿ K çº¿**ï¼šçŸ­æœŸä»·æ ¼èµ°åŠ¿ã€EMA20ã€MACDã€RSI(7)
- **4 å°æ—¶ K çº¿**ï¼šé•¿æœŸè¶‹åŠ¿ã€EMA20/50ã€ATRã€RSI(14)
- **æŒä»“é‡ï¼ˆOIï¼‰**ï¼šå¸‚åœºæƒ…ç»ªã€èµ„é‡‘è´¹ç‡ã€æ¸…ç®—æ•°æ®
- **OI Top è·Ÿè¸ª**ï¼šæŒä»“é‡å¢é•¿æœ€å¿«çš„å‰ 20 ä¸ªå¸ç§

æŠ€æœ¯æŒ‡æ ‡ä½¿ç”¨ go-talib è®¡ç®—ï¼ˆéœ€è¦ TA-Lib C åº“ï¼‰ã€‚

### REST API å±‚

`api` åŒ…ï¼ˆapi/server.goï¼‰æä¾›ï¼š
- **ç«èµ›ç«¯ç‚¹**ï¼š`/api/competition`ã€`/api/traders`ï¼ˆå¤šäº¤æ˜“å‘˜æ’è¡Œæ¦œï¼‰
- **äº¤æ˜“å‘˜ç‰¹å®šç«¯ç‚¹**ï¼š`/api/status?trader_id=xxx`ã€`/api/account`ã€`/api/positions`ã€`/api/equity-history`ã€`/api/decisions/latest`ã€`/api/statistics`
- **ç³»ç»Ÿç«¯ç‚¹**ï¼š`/health`ã€`/api/config`

æ‰€æœ‰ç«¯ç‚¹ä½¿ç”¨ Gin æ¡†æ¶ï¼Œä¸ºæœ¬åœ°å¼€å‘å¯ç”¨äº† CORSã€‚

### å‰ç«¯æ¶æ„

React åº”ç”¨ï¼ˆweb/src/ï¼‰ä½¿ç”¨ï¼š
- **SWR**ï¼šæ•°æ®è·å–ï¼Œ5 ç§’è‡ªåŠ¨åˆ·æ–°å®ç°å®æ—¶æ›´æ–°
- **Recharts**ï¼šæƒç›Šæ›²çº¿å’Œæ€§èƒ½æ¯”è¾ƒå›¾è¡¨
- **Zustand**ï¼šå…¨å±€çŠ¶æ€ç®¡ç†ï¼ˆæœ€å°ä½¿ç”¨ï¼‰
- **TailwindCSS**ï¼šBinance é£æ ¼çš„æ·±è‰²ä¸»é¢˜ï¼ˆé‡‘è‰² #F0B90B + æ·±è‰²èƒŒæ™¯ï¼‰

**å…³é”®ç»„ä»¶**ï¼š
- `CompetitionPage.tsx`ï¼šå¤šäº¤æ˜“å‘˜æ’è¡Œæ¦œï¼Œå®æ—¶ ROI æ¯”è¾ƒ
- `EquityChart.tsx`ï¼šå†å²è´¦æˆ·ä»·å€¼è¶‹åŠ¿ï¼ˆUSD/ç™¾åˆ†æ¯”åˆ‡æ¢ï¼‰
- `ComparisonChart.tsx`ï¼šå¹¶æ’ AI æ€§èƒ½æ¯”è¾ƒï¼ˆåŸºäºæ—¶é—´æˆ³åˆ†ç»„ï¼‰
- `AILearning.tsx`ï¼šæ˜¾ç¤ºå†å²åé¦ˆå’Œæ€§èƒ½åˆ†æ

## é‡è¦æŠ€æœ¯çº¦æŸ

### ä½¿ç”¨ symbol_side é”®è·Ÿè¸ªæŒä»“

**å…³é”®**ï¼šç³»ç»Ÿä½¿ç”¨ `symbol_side` æ ¼å¼ï¼ˆä¾‹å¦‚ "BTCUSDT_long"ã€"BTCUSDT_short"ï¼‰è·Ÿè¸ªæŒä»“ï¼Œè€Œä¸ä»…ä»…æ˜¯ `symbol`ã€‚è¿™å¯ä»¥é˜²æ­¢åŒæ—¶æŒæœ‰å¤šç©ºæŒä»“æ—¶çš„æ•°æ®å†²çªã€‚

åœ¨ç¼–å†™æŒä»“è·Ÿè¸ªä»£ç æ—¶ï¼š
- å§‹ç»ˆä½¿ç”¨ `fmt.Sprintf("%s_%s", symbol, side)` ä½œä¸ºæŒä»“é”®
- æ°¸è¿œä¸è¦å•ç‹¬ä½¿ç”¨ `symbol` ä½œä¸ºæŒä»“çš„ map é”®

### å‡†ç¡®çš„ç›ˆäºè®¡ç®—ï¼ˆv2.0.2+ï¼‰

**å…¬å¼**ï¼š`ç›ˆäºï¼ˆUSDTï¼‰= æŒä»“ä»·å€¼ Ã— ä»·æ ¼å˜åŒ–% Ã— æ æ†`

ç¤ºä¾‹ï¼š1000 USDT æŒä»“ Ã— 5% ä»·æ ¼å˜åŠ¨ Ã— 20x æ æ† = 1000 USDT åˆ©æ¶¦

**æŒä»“è®°å½•ä¸­çš„å¿…éœ€å­—æ®µ**ï¼š
- `quantity`ï¼ˆæŒä»“å¤§å°ï¼Œä»¥å¸ä¸ºå•ä½ï¼‰
- `leverage`ï¼ˆæ æ†å€æ•°ï¼‰
- `entry_price`ï¼ˆå¼€ä»“ä»·æ ¼ï¼‰

æ²¡æœ‰è¿™äº›å­—æ®µï¼Œç›ˆäºè®¡ç®—å°†ä¸å‡†ç¡®ã€‚

### äº¤æ˜“æ‰€ç‰¹å®šçš„ç²¾åº¦å¤„ç†

æ¯ä¸ªäº¤æ˜“æ‰€å¯¹æ•°é‡å’Œä»·æ ¼æœ‰ä¸åŒçš„ç²¾åº¦è¦æ±‚ï¼š
- **Binance**ï¼šä» `/fapi/v1/exchangeInfo` ä½¿ç”¨ `LOT_SIZE` å’Œ `PRICE_FILTER`
- **Hyperliquid**ï¼šä» meta ç«¯ç‚¹è‡ªåŠ¨è·å–ç²¾åº¦
- **Aster**ï¼šBinance å…¼å®¹ï¼Œä» `/fapi/v1/exchangeInfo` è·å–

åœ¨ä¸‹å•å‰å§‹ç»ˆä½¿ç”¨ `Trader.FormatQuantity()` ä»¥é¿å…ç²¾åº¦é”™è¯¯ã€‚

### Binance å­è´¦æˆ·æ æ†é™åˆ¶

**å…³é”®çº¦æŸ**ï¼šBinance å­è´¦æˆ·é™åˆ¶ä¸º â‰¤5x æ æ†ã€‚å¦‚æœ `config.json` æœ‰æ›´é«˜çš„æ æ†å€¼å¹¶ä½¿ç”¨å­è´¦æˆ·ï¼Œäº¤æ˜“å°†å¤±è´¥ï¼Œé”™è¯¯ä¿¡æ¯ï¼š
```
Subaccounts are restricted from using leverage greater than 5x
```

ä¸»è´¦æˆ·å¯ä»¥ä½¿ç”¨ï¼š
- BTC/ETHï¼š50xï¼ˆé«˜é£é™©ï¼‰
- å±±å¯¨å¸ï¼š20xï¼ˆéå¸¸é«˜é£é™©ï¼‰

**å®‰å…¨é»˜è®¤å€¼**ï¼šåœ¨é…ç½®ä¸­è®¾ç½® `btc_eth_leverage: 5` å’Œ `altcoin_leverage: 5`ã€‚

### AI å†³ç­–æ¨¡å¼éªŒè¯

AI å¿…é¡»è¿”å›ç¬¦åˆæ­¤æ¨¡å¼çš„æœ‰æ•ˆ JSONï¼š
```json
{
  "symbol": "BTCUSDT",
  "action": "open_long|open_short|close_long|close_short|hold|wait",
  "leverage": 5,
  "position_size_usd": 100.0,
  "stop_loss": 95000.0,
  "take_profit": 105000.0,
  "confidence": 75,
  "risk_usd": 50.0,
  "reasoning": "..."
}
```

å¦‚æœ AI è¿”å›æ ¼å¼é”™è¯¯çš„ JSONï¼Œå¾ªç¯å°†å¤±è´¥å¹¶è®°å½•é”™è¯¯ã€‚

### æŒä»“æ—¶é•¿è·Ÿè¸ªï¼ˆv2.0.2+ï¼‰

ç³»ç»Ÿé€šè¿‡åœ¨ AutoTrader ä¸­å­˜å‚¨ `positionFirstSeenTime` æ¥è·Ÿè¸ªæ¯ä¸ªæŒä»“æŒæœ‰çš„æ—¶é—´ã€‚æ­¤æ—¶é—´æˆ³åœ¨æç¤ºä¸­æ˜¾ç¤ºä¸º"æŒä»“æ—¶é•¿2å°æ—¶15åˆ†é’Ÿ"ï¼Œä»¥å¸®åŠ© AI åšå‡ºé€€å‡ºæ—¶æœºå†³ç­–ã€‚

## ä»£ç è´¨é‡æŒ‡å—

- **é”™è¯¯å¤„ç†**ï¼šå§‹ç»ˆä½¿ç”¨ `fmt.Errorf("...: %w", err)` åŒ…è£…é”™è¯¯å¹¶æ·»åŠ ä¸Šä¸‹æ–‡
- **æ—¥å¿—è®°å½•**ï¼šä½¿ç”¨å¸¦äº¤æ˜“å‘˜åç§°å‰ç¼€çš„ç»“æ„åŒ–æ—¥å¿—æ¶ˆæ¯ï¼š`log.Printf("ğŸ¤– [%s] ...", traderName)`
- **å¹¶å‘**ï¼šTraderManager ä½¿ç”¨ sync.RWMutex å¯¹ traders map è¿›è¡Œçº¿ç¨‹å®‰å…¨è®¿é—®
- **JSON åºåˆ—åŒ–**ï¼šå†³ç­–æ—¥å¿—ä½¿ç”¨ `json.MarshalIndent`ï¼ˆäººç±»å¯è¯»ï¼‰ï¼ŒAPI å“åº”ä½¿ç”¨å¸¸è§„ `json.Marshal`
- **æ—¶é—´å¤„ç†**ï¼šå†…éƒ¨å§‹ç»ˆä½¿ç”¨ `time.Time`ï¼Œä»…åœ¨å­˜å‚¨/API æ—¶è½¬æ¢ä¸º Unix æ—¶é—´æˆ³
- **æµ®ç‚¹ç²¾åº¦**ï¼šæ‰€æœ‰é‡‘èè®¡ç®—ä½¿ç”¨ `float64`ï¼Œä»…åœ¨ä¸‹å•æ—¶æ ¼å¼åŒ–ä¸ºäº¤æ˜“æ‰€ç²¾åº¦

## å¸¸è§å¼€å‘ä»»åŠ¡

### æ·»åŠ æ–°äº¤æ˜“æ‰€

1. åœ¨æ–°æ–‡ä»¶ä¸­å®ç° `Trader` æ¥å£ï¼ˆä¾‹å¦‚ `trader/new_exchange.go`ï¼‰
2. å°†äº¤æ˜“æ‰€ç‰¹å®šçš„é…ç½®å­—æ®µæ·»åŠ åˆ° `config.TraderConfig`
3. åœ¨ `config.Validate()` ä¸­æ·»åŠ éªŒè¯
4. åœ¨ `AutoTrader.NewAutoTrader()` çš„ switch è¯­å¥ä¸­æ·»åŠ åˆ†æ”¯
5. æ›´æ–° README.md ä¸­çš„æ–°äº¤æ˜“æ‰€æ–‡æ¡£

### æ·»åŠ æ–° AI æä¾›å•†

1. åœ¨ `mcp/client.go` ä¸­æ·»åŠ æ–°çš„æä¾›å•†å¸¸é‡ï¼ˆä¾‹å¦‚ `ProviderNewAI`ï¼‰
2. åœ¨ `mcp.Client` ä¸­å®ç° `SetNewAIAPIKey()` æ–¹æ³•
3. æ›´æ–° `config.Validate()` ä»¥éªŒè¯æ–°çš„ AI é…ç½®
4. åœ¨ CUSTOM_API.md ä¸­æ·»åŠ ç¤ºä¾‹

### ä¿®æ”¹ AI å†³ç­–é€»è¾‘

1. åœ¨ `decision/engine.go` â†’ `buildSystemPrompt()` ä¸­ç¼–è¾‘ç³»ç»Ÿæç¤º
2. åœ¨ `decision/engine.go` â†’ `buildUserPrompt()` ä¸­ç¼–è¾‘ç”¨æˆ·æç¤º
3. æ›´æ–°æ³¨é‡Šä¸­çš„ JSON æ¨¡å¼æ–‡æ¡£
4. ä½¿ç”¨ `./nofx` æµ‹è¯•å¹¶ç›‘æ§æ—¥å¿—ä¸­çš„è§£æé”™è¯¯

### æ·»åŠ æ–°æŠ€æœ¯æŒ‡æ ‡

1. åœ¨ `market/data.go` ä¸­ä½¿ç”¨ go-talib å‡½æ•°æ·»åŠ è®¡ç®—
2. å‘ `market.Data` ç»“æ„ä½“æ·»åŠ æ–°å­—æ®µ
3. åœ¨ç”¨æˆ·æç¤ºç”Ÿæˆä¸­åŒ…å«ï¼ˆ`decision/engine.go`ï¼‰
4. å¦‚æœæ·»åŠ æ–°å›¾è¡¨ç±»å‹ï¼Œé‡æ–°æ„å»ºå‰ç«¯

## æµ‹è¯•å’Œè°ƒè¯•

### åç«¯æµ‹è¯•

```bash
# ä½¿ç”¨è¯¦ç»†æ—¥å¿—è¿è¡Œ
LOG_LEVEL=debug ./nofx

# ä½¿ç”¨å°èµ„é‡‘æµ‹è¯•
# ç¼–è¾‘ config.jsonï¼š"initial_balance": 100.0

# æ¨¡æ‹Ÿè¿è¡Œæ¨¡å¼ï¼ˆå¦‚æœå·²å®ç°ï¼‰
# æ£€æŸ¥ä»£ç ä¸­çš„æ¨¡æ‹Ÿè¿è¡Œæ ‡å¿—
```

### å‰ç«¯æµ‹è¯•

```bash
cd web
npm run dev

# è®¿é—® http://localhost:3000
# åç«¯å¿…é¡»è¿è¡Œåœ¨ http://localhost:8080
```

### å†³ç­–æ—¥å¿—åˆ†æ

å†³ç­–æ—¥å¿—å­˜å‚¨åœ¨ `decision_logs/{trader_id}/decision_YYYYMMDD_HHMMSS_cycleN.json`

æ¯ä¸ªæ—¥å¿—åŒ…å«ï¼š
- `input_prompt`ï¼šå‘é€ç»™ AI çš„å†…å®¹
- `cot_trace`ï¼šAI çš„æ€ç»´é“¾æ¨ç†
- `decision_json`ï¼šè§£æçš„å†³ç­–
- `execution_log`ï¼šäº¤æ˜“æ‰§è¡Œç»“æœ
- `success`ï¼šå¾ªç¯æ˜¯å¦æˆåŠŸå®Œæˆ

æŸ¥çœ‹è¿™äº›æ—¥å¿—ä»¥è°ƒè¯• AI å†³ç­–æˆ–æ‰§è¡Œå¤±è´¥ã€‚

### å¸¸è§é—®é¢˜

**é—®é¢˜**ï¼š"Precision is over the maximum defined for this asset"
- **åŸå› **ï¼šæ•°é‡/ä»·æ ¼æœªæ ¼å¼åŒ–ä¸ºäº¤æ˜“æ‰€ç²¾åº¦
- **ä¿®å¤**ï¼šç¡®ä¿åœ¨ä¸‹å•å‰è°ƒç”¨ `Trader.FormatQuantity()`

**é—®é¢˜**ï¼šBinance å­è´¦æˆ·æ æ†é”™è¯¯
- **åŸå› **ï¼šé…ç½®ä¸­æ æ† >5x ä½†ä½¿ç”¨å­è´¦æˆ·
- **ä¿®å¤**ï¼šè®¾ç½® `leverage.btc_eth_leverage: 5` å’Œ `leverage.altcoin_leverage: 5`

**é—®é¢˜**ï¼šAI æ¯ä¸ªå‘¨æœŸéƒ½è¿”å›"ç­‰å¾…"
- **åŸå› **ï¼šæ²¡æœ‰å€™é€‰å¸ç§ï¼Œæˆ–æ‰€æœ‰å¸ç§è¢«æµåŠ¨æ€§è¿‡æ»¤
- **ä¿®å¤**ï¼šæ£€æŸ¥å¸ç§æ±  APIï¼Œæˆ–å¯ç”¨ `use_default_coins: true`

**é—®é¢˜**ï¼šå‰ç«¯æ˜¾ç¤º"æ— æ•°æ®"
- **åŸå› **ï¼šåç«¯æœªè¿è¡Œï¼Œæˆ–ç«¯å£ä¸åŒ¹é…
- **ä¿®å¤**ï¼šéªŒè¯åç«¯åœ¨ http://localhost:8080/healthï¼Œæ£€æŸ¥ CORS

## ä¾èµ–é¡¹

### åç«¯ (Go)
- `github.com/adshao/go-binance/v2` - Binance Futures API å®¢æˆ·ç«¯
- `github.com/sonirico/go-hyperliquid` - Hyperliquid SDK
- `github.com/ethereum/go-ethereum` - ä»¥å¤ªåŠåŠ å¯†ï¼ˆç”¨äº Hyperliquid/Asterï¼‰
- `github.com/gin-gonic/gin` - HTTP API æ¡†æ¶
- TA-Lib C åº“ï¼ˆæŠ€æœ¯æŒ‡æ ‡è®¡ç®—æ‰€éœ€ï¼‰

### å‰ç«¯ (React)
- `react` + `react-dom` - UI æ¡†æ¶
- `recharts` - å›¾è¡¨åº“
- `swr` - æ•°æ®è·å–å’Œè‡ªåŠ¨åˆ·æ–°
- `tailwindcss` - å®ç”¨ä¼˜å…ˆçš„ CSS
- `date-fns` - æ—¥æœŸæ ¼å¼åŒ–

### å®‰è£… TA-Lib

**macOS**ï¼š
```bash
brew install ta-lib
```

**Ubuntu/Debian**ï¼š
```bash
sudo apt-get install libta-lib0-dev
```

**ä»æºç å®‰è£…**ï¼ˆå¦‚æœåŒ…ç®¡ç†å™¨å¤±è´¥ï¼‰ï¼š
```bash
wget http://prdownloads.sourceforge.net/ta-lib/ta-lib-0.4.0-src.tar.gz
tar -xzf ta-lib-0.4.0-src.tar.gz
cd ta-lib/
./configure --prefix=/usr
make
sudo make install
```

## ç‰ˆæœ¬å†å²æ³¨é‡Š

**v2.0.2**ï¼ˆ2025-10-29ï¼‰å¼•å…¥çš„å…³é”®ä¿®å¤ï¼š
- å‡†ç¡®çš„ USDT ç›ˆäºè®¡ç®—ï¼ˆä¹‹å‰ä»…ç™¾åˆ†æ¯”ï¼‰
- ä½¿ç”¨ `symbol_side` é”®è·Ÿè¸ªæŒä»“ï¼ˆé˜²æ­¢å¤šç©ºå†²çªï¼‰
- æŒä»“æ—¶é•¿è·Ÿè¸ªï¼ˆæ˜¾ç¤ºæŒä»“æŒæœ‰æ—¶é—´ï¼‰
- ä½¿ç”¨ `math.Sqrt` è®¡ç®—å¤æ™®æ¯”ç‡ï¼ˆæ›¿æ¢è‡ªå®šä¹‰å®ç°ï¼‰

v2.0.2 ä¹‹å‰ç¼–å†™çš„ä»£ç å¯èƒ½æœ‰ä¸æ­£ç¡®çš„ç›ˆäºè®¡ç®—ã€‚

## éƒ¨ç½²

ç”Ÿäº§éƒ¨ç½²è¯·å‚è§ï¼š
- Dockerï¼š`DOCKER_DEPLOY.md`ï¼ˆä¸­æ–‡ï¼‰æˆ– `DOCKER_DEPLOY.en.md`ï¼ˆè‹±æ–‡ï¼‰
- PM2ï¼š`PM2_DEPLOYMENT.md`

å®‰å…¨æ€§ï¼š
- æ°¸è¿œä¸è¦æäº¤åŒ…å«çœŸå® API å¯†é’¥çš„ `config.json`
- ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–å¯†é’¥ç®¡ç†
- å°† API å¯†é’¥é™åˆ¶ä¸ºä»…äº¤æ˜“æƒé™ï¼ˆæ— æç°ï¼‰
- åœ¨äº¤æ˜“æ‰€ API å¯†é’¥ä¸Šä½¿ç”¨ IP ç™½åå•
- è€ƒè™‘ä½¿ç”¨äº¤æ˜“æ‰€å­è´¦æˆ·è¿›è¡Œéš”ç¦»
